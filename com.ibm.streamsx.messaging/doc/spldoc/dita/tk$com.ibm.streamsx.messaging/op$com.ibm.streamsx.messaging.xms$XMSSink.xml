<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="spldoc_operator">
<title>Operator <tt>XMSSink</tt></title>
<refbody>
<section>
<p>
<xref href="../toolkits/toolkits.xml">IBMStreams com.ibm.streamsx.messaging Toolkit</xref> &gt; <xref href="tk$com.ibm.streamsx.messaging.xml">com.ibm.streamsx.messaging 2.0.0</xref> &gt; <xref href="ns$com.ibm.streamsx.messaging.xms.xml">com.ibm.streamsx.messaging.xms</xref> &gt; XMSSink</p>
</section>
<section>

<p>The <tt>XMSSink</tt> operator takes messages from IBM InfoSphere Streams and can send them to a WebSphere MQ queue or topic.
</p>
<p>The incoming tuple from InfoSphere Streams can be one or many of the following data types: int8, uint8, int16, uint16, int32, uint32, int64, float32, float64, boolean, blob, or rstring. The input tuple is serialized into a WebSphere MQ message either as a map, stream, bytes, xml, wbe, or wbe22 message, according to the value of the message_class attribute in the connection specifications document. An additional empty value can be specified in the message_class attribute, in which case the operator constructs an empty JMS or XMS message. This message class cannot be used with a native schema.
</p>
<p><b>Exceptions</b>
</p>
<p>The following list describes the common types of exceptions that can occur:
<ul>
<li> Run-time errors that halt the operator execution.
<ul>
<li> The <tt>XMSSink</tt> operator throws an exception and terminates in the following cases:
<ul>
<li> During the initial connect attempt, the <b>reconnectionPolicy</b> is set to <tt>NoRetry</tt> and the operator does not have a successful connection, or during transient connection failures the <b>reconnectionPolicy</b> is set to <tt>BoundedRetry</tt> and the operator does not have a successful connection after the number of attempts that are specified in the <b>reconnectionBound</b> parameter. Successive data is lost.</li>
<li> The queue name is unknown.</li>
<li> The user is not an authorized user of the queue.</li>
<li> The queue manager name is unknown.</li>
<li> The operator is unable to connect to the host.</li>
<li> The operator is unable to connect to the port.</li>
</ul></li>
</ul></li>
<li> Run-time errors that cause the message to be dropped and an error message to be logged
<ul>
<li> The <tt>XMSSink</tt> operator throws an exception and discards the message in the following circumstances:
<ul>
<li> The data that is being written is longer than the maximum message length specified in the queue in WebSphere MQ.</li>
</ul></li>
<li> The discarded message is not sent to the WebSphere MQ queue or topic.</li>
</ul></li>
<li> Compile-time errors
<ul>
<li> The <tt>XMSSink</tt> operator throws a compile-time error in the following cases:
<ul>
<li> A native schema is specified and the message class is empty.</li>
<li> There is a mismatch between the data type of one or more attributes in the native schema and the data type of attributes in the input stream.</li>
<li> One or more native schema attributes do not have a matching attribute in the input stream schema.</li>
<li> The <tt>connections.xml</tt> file does not conform to <tt>connections.xsd</tt>.</li>
<li> The <b>connectionsDocument</b> parameter refers to a nonexistent connections file.</li>
<li> The <b>connectionsDocument</b> parameter is not specified and there is no <tt>connections.xml</tt> file inside the <tt>etc</tt> directory.</li>
<li> An invalid value is specified for the message class.</li>
<li> The <b>access</b> parameter does not refer to an existing access element in the native schema.</li>
<li> The <b>connection</b> parameter does not refer to an existing access element in the native schema.</li>
<li> A length is specified for a native schema attribute that does not have a string or blob data type.</li>
<li> A negative length is specified for a string or blob attribute in the native schema for a map, stream, xml, wbe, or wbe22 message class.</li>
<li> A negative length other than -2, -4, or -8 is specified for a string or blob attribute in the native schema for a bytes message class.</li>
</ul></li>
</ul></li>
</ul>
</p>
<p>In all of these cases, the operator logs the exception in the console logs. The information about the exception is also sent to the optional error output port, unless it is a run-time error that halts the operator or a compile-time error.
</p>
<p>Note: The <tt>XMSSink</tt> operator runs without considering the length value for all message classes for string and bytes data types when a negative length of -1 is provided; it does not throw an error at either compile time or run time.
</p>
<p><b>Examples</b>
</p>
<p>The following example demonstrates the use of multiple <tt>XMSSink</tt> operators with different parameter combinations and an optional error output port:
</p>
<p>
<codeblock>
<![CDATA[composite Main{
graph
stream <int32 id, rstring fname, rstring lname>
MyPersonNamesStream=Beacon()
{
	param
	iterations:10u;
}
//XMSSink Operator with connections.xml 
//defaulted to ./etc/connections.xml
() as MySink1=XMSSink(MyPersonNamesStream)
{
	param
		connection: "wbe";
		access: "OutTrading";
}	

//XMSSink Operator with the fully qualified 
//name of connections.xml
() as MySink2=XMSSink(MyPersonNamesStream)
{
	param
		connectionDocument:"/home/streamsuser/connections/XMSconnections.xml";
		connection: "wbe";
		access: "OutTrading";
}	

//XMSSink Operator with optional 
//output error port specified
stream <tuple<int32 id, rstring fname, 
rstring lname>inTuple, rstring errorMessage>
MySink3 = XMSSink(MyPersonNamesStream)
{
	param
		connection: "wbe";
		access: "OutTrading";
}
//XMSSink Operator with reconnectionPolicy 
//specified as NoRetry
() as  MySink4 = XMSSink( MyPersonNamesStream ) 
{
	param
		connection: "wbe";
		access: "OutTrading";
		reconnectionPolicy: NoRetry;
}	

//XMSSink Operator with optional period 
//and reconnectionPolicy specified
() as MySink5 = XMSSink( MyPersonNamesStream )
{
	param
		connection: "wbe";
		access: "OutTrading";
		reconnectionPolicy: InfiniteRetry;
		period: 1.20;
}
//XMSSink Operator with reconnectionPolicy 
//specified as BoundedRetry
() as MySink6 = XMSSink( MyPersonNamesStream )
{
	param
		connection: "wbe";
		access: "OutTrading";
		reconnectionPolicy: BoundedRetry;
		reconnectionBound: 2u;
		period: 1.20;
}
}
]]></codeblock>

</p>
<p>The following is a sample <tt>connections.xml</tt> file:
</p>
<p>
<codeblock>
<![CDATA[<st:connections xmlns:st="http://www.ibm.com/xmlns/prod/streams/adapters"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<connection_specifications>
	<connection_specification name="wbe">
		<XMS initial_context="file:///opt/InitialContext/" 
		connection_factory="TestConFac"  />
	</connection_specification>
</connection_specifications>	

<access_specifications>
	<access_specification name="OutTrading">
]]></codeblock>
  			&lt;destination identifier="TestDestination" 
<codeblock>
<![CDATA[		delivery_mode="persistent" message_class="map" />
]]></codeblock>
  			&lt;uses_connection connection="wbe"/&gt;
<codeblock>
<![CDATA[		<native_schema>
			<attribute name="id" type="Int"/>
			<attribute name="fname" type="String"/>
			<attribute name="lname" type="String"/>
		</native_schema>
	</access_specification>
</access_specifications>
</st:connections>	
]]></codeblock>

</p>
</section>
<section outputclass="splprimop">
<object type="image/svg+xml" data="../../image/tk$com.ibm.streamsx.messaging/op$com.ibm.streamsx.messaging.xms$XMSSink.svg" width="672" height="112">
<desc>Primitive operator image not displayed. Problem loading file: ../../image/tk$com.ibm.streamsx.messaging/op$com.ibm.streamsx.messaging.xms$XMSSink.svg
</desc>
</object>
</section>
<section>
<title outputclass="splhead-1">Summary</title>
<dl compact="yes">
 <dlentry>
  <dt>Ports</dt>
  <dd>This operator has 1 input port and 1 output port.</dd>
 </dlentry>
 <dlentry>
  <dt>Windowing</dt>
  <dd>This operator does not accept any windowing configurations.</dd>
 </dlentry>
 <dlentry>
  <dt>Parameters</dt>
  <dd>This operator supports 6 parameters.
<p> Required: 
<xref href="#spldoc_operator/parameter__connection">connection</xref>, <xref href="#spldoc_operator/parameter__access">access</xref>

</p>
<p> Optional: 
<xref href="#spldoc_operator/parameter__reconnectionPolicy">reconnectionPolicy</xref>, <xref href="#spldoc_operator/parameter__reconnectionBound">reconnectionBound</xref>, <xref href="#spldoc_operator/parameter__period">period</xref>, <xref href="#spldoc_operator/parameter__connectionDocument">connectionDocument</xref>

</p></dd>
 </dlentry>
 <dlentry>
  <dt>Metrics</dt>
  <dd>This operator reports 3 metrics.</dd>
 </dlentry>
</dl></section>
<section>
<title outputclass="splhead-1">Properties</title>
<dl compact="yes">
 <dlentry>
  <dt>Implementation</dt>
  <dd>C++</dd>
 </dlentry>
 <dlentry>
  <dt><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__providessinglethreadedexecutioncontext">Threading</xref></dt>
  <dd><tt>Always</tt> - Operator always provides a single threaded execution context.</dd>
 </dlentry>
</dl>
</section>
<section>
<p outputclass="splhead-1"><b><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/input_port_set">Input Ports</xref></b></p><dl>
  <dlentry>
   <dt>Ports (0)</dt>
   <dd>
<p>The <tt>XMSSink</tt> operator is configurable with a single input data port, which is required.  The input port is non-mutating and its punctuation mode is Oblivious. 
</p>
   <dl>
    <dlentry>
      <dt>Properties</dt>
      <dd>   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/input_port_set__optional">Optional</xref>: false
     </sli>
   </sl>
   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/input_port_set__controlport">ControlPort</xref>: false
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/input_port_set__tuplemutationallowed">TupleMutationAllowed</xref>: false
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/input_port_set__windowingmode">WindowingMode</xref>: NonWindowed
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/input_port_set__windowpunctuationinputmode">WindowPunctuationInputMode</xref>: Oblivious
     </sli>
   </sl>
      </dd>    </dlentry>
   </dl>
   <p></p>   </dd>
  </dlentry>
</dl>
</section>
<section>
<p outputclass="splhead-1"><b><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/output_port_set">Output Ports</xref></b></p><dl>
  <dlentry>
     <dt>Assignments</dt>
     <dd>This operator requires that assignments made to output attributes must evaluate at compile-time to a constant.</dd>
  </dlentry>
</dl>
 <dl>
  <dlentry>
   <dt>Ports (0)</dt>
   <dd>

<p>The <tt>XMSSink</tt> operator is configurable with an optional port that submits a tuple when an error occurs.  The optional port is mutating and its punctuation mode is Free.
</p>
<p>The error output port contains an optional first attribute which contains the input tuple that caused the error and a second attribute of type rstring that details the error message. Only one error message is sent per failed tuple. 
</p>
    <p></p>
    <dl>
     <dlentry>
      <dt>Properties</dt>
      <dd>   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/output_port_set__optional">Optional</xref>: true
     </sli>
   </sl>
   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/output_port_set__tuplemutationallowed">TupleMutationAllowed</xref>: true
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/output_port_set__windowpunctuationoutputmode">WindowPunctuationOutputMode</xref>: Free
     </sli>
   </sl>
</dd>     </dlentry>
    </dl>
    <p></p>
   </dd>
  </dlentry>
</dl>
</section>
<section>
<p outputclass="splhead-1"><b><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters">Parameters</xref></b></p>This operator supports 6 parameters.<dl>
  <dlentry id="parameter__reconnectionPolicy">
     <dt><tt>reconnectionPolicy</tt></dt>
     <dd>
<p>This is an optional parameter that specifies the reconnection policy. The valid values are <tt>NoRetry</tt>, <tt>InfiniteRetry</tt>, and <tt>BoundedRetry</tt>. If the parameter is not specified, the reconnection policy is set to <tt>BoundedRetry</tt> with a <b>reconnectionBound</b> of <tt>5</tt> and a <b>period</b> of 60 seconds.
</p>
  <dl>
    <dlentry>
     <dt>Properties</dt>
     <dd>   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__type">Type</xref>: ReconnectionPolicy
 (<tt>InfiniteRetry, NoRetry, BoundedRetry</tt>)     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__cardinality">Cardinality</xref>: 1
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__optional">Optional</xref>: true
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__expressionmode">ExpressionMode</xref>: CustomLiteral
     </sli>
   </sl>
     <p></p>     </dd>
    </dlentry>
  </dl>
     </dd>
  </dlentry>
  <dlentry id="parameter__reconnectionBound">
     <dt><tt>reconnectionBound</tt></dt>
     <dd>
<p>This optional parameter specifies the number of successive connections that are attempted for an operator. You can use this parameter only when the <b>reconnectionPolicy</b> parameter is specified and set to <tt>BoundedRetry</tt>, otherwise a compile-time error occurs. If the <b>reconnectionBound</b> parameter is specified and the <b>reconnectionPolicy</b> parameter is not set, a compile-time error occurs. The default value for the <b>reconnectionBound</b> parameter is <tt>5</tt>.
</p>
  <dl>
    <dlentry>
     <dt>Properties</dt>
     <dd>   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__type">Type</xref>: uint32
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__cardinality">Cardinality</xref>: 1
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__optional">Optional</xref>: true
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__expressionmode">ExpressionMode</xref>: AttributeFree
     </sli>
   </sl>
     <p></p>     </dd>
    </dlentry>
  </dl>
     </dd>
  </dlentry>
  <dlentry id="parameter__period">
     <dt><tt>period</tt></dt>
     <dd>
<p>This optional parameter specifies the time period in seconds the operator waits before it tries to reconnect. You can use this parameter only when the <b>reconnectionPolicy</b> parameter is specified, otherwise a compile-time error occurs. The default value for the <b>period</b> parameter is <tt>60</tt>.		 
</p>
  <dl>
    <dlentry>
     <dt>Properties</dt>
     <dd>   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__type">Type</xref>: float64
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__cardinality">Cardinality</xref>: 1
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__optional">Optional</xref>: true
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__expressionmode">ExpressionMode</xref>: AttributeFree
     </sli>
   </sl>
     <p></p>     </dd>
    </dlentry>
  </dl>
     </dd>
  </dlentry>
  <dlentry id="parameter__connection">
     <dt><tt>connection</tt></dt>
     <dd>
<p>This mandatory parameter identifies the name of the connection specification that contains an XMS element.
</p>
  <dl>
    <dlentry>
     <dt>Properties</dt>
     <dd>   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__type">Type</xref>: rstring
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__cardinality">Cardinality</xref>: 1
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__optional">Optional</xref>: false
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__expressionmode">ExpressionMode</xref>: AttributeFree
     </sli>
   </sl>
     <p></p>     </dd>
    </dlentry>
  </dl>
     </dd>
  </dlentry>
  <dlentry id="parameter__access">
     <dt><tt>access</tt></dt>
     <dd>
<p>This mandatory parameter identifies the access specification name.
</p>
  <dl>
    <dlentry>
     <dt>Properties</dt>
     <dd>   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__type">Type</xref>: rstring
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__cardinality">Cardinality</xref>: 1
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__optional">Optional</xref>: false
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__expressionmode">ExpressionMode</xref>: AttributeFree
     </sli>
   </sl>
     <p></p>     </dd>
    </dlentry>
  </dl>
     </dd>
  </dlentry>
  <dlentry id="parameter__connectionDocument">
     <dt><tt>connectionDocument</tt></dt>
     <dd>
<p>This optional parameter specifies the path name of the file that contains the connection and access specifications, which are identified by the <b>connection</b> and <b>access</b> parameters. If the parameter is specified, it must have exactly one value that is a string constant.  If the parameter is not specified, the operator uses the file that is in the default location <tt>../etc/connections.xml</tt>.  If a relative path is specified, the path is relative to the root of the applicaiton directory.		 
</p>
  <dl>
    <dlentry>
     <dt>Properties</dt>
     <dd>   <sl>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__type">Type</xref>: rstring
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__cardinality">Cardinality</xref>: 1
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__optional">Optional</xref>: true
     </sli>
     <sli><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/parameters__parameter__expressionmode">ExpressionMode</xref>: AttributeFree
     </sli>
   </sl>
     <p></p>     </dd>
    </dlentry>
  </dl>
     </dd>
  </dlentry>
</dl>
</section>
<section>
<p outputclass="splhead-1"><b><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__codetemplate">Code Templates</xref></b></p>  <dl>
    <dlentry>
     <dt>XMSSink</dt>
     <dd>
       <codeblock>
<![CDATA[() as ${sinkPrefix}Sink = XMSSink(${inputStream})   {
            param
            	connection : "${ConnectionSpecificationName}";
                access : "${AccessSpecificationName}";
        }]]>
      </codeblock>
     <p></p>
     </dd>
    </dlentry>
  </dl>
</section>
<section>
<p outputclass="splhead-1"><b><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__metrics">Metrics</xref></b></p><dl>
  <dlentry>
    <dt><tt>nTruncatedInserts</tt> - <xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__metrics_kind_counter">Counter</xref></dt>
    <dd>

<p>The number of tuples that have truncated attributes when they are converted to a message.
</p>
     <p></p>
     </dd>
  </dlentry>
  <dlentry>
    <dt><tt>nFailedInserts</tt> - <xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__metrics_kind_counter">Counter</xref></dt>
    <dd>

<p>The number of failed inserts to the WebSphere MQ.  Failed insertions can occur when a message is dropped because of a run-time error.
</p>
     <p></p>
     </dd>
  </dlentry>
  <dlentry>
    <dt><tt>nConnectionAttempts</tt> - <xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__metrics_kind_counter">Counter</xref></dt>
    <dd>

<p>The number of connection attempts that are made before a successful connection.
</p>
     <p></p>
     </dd>
  </dlentry>
</dl>
</section>
<section>
<p outputclass="splhead-1"><b><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies">Libraries</xref></b></p><dl>
 <dlentry>
  <dt><tt> IBM Message Service Client for C/C++ (XMS) libraries</tt>  </dt>
<dd/>  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__command">Command</xref>: 
  </dd>
  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__lib">Library Name</xref>: <tt>gxi01l, gxi</tt></dd>
  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__libpath">Library Path</xref>: <tt>@XMS_HOME@/lib64</tt></dd>
  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__includepath">Include Path</xref>: <tt>@XMS_HOME@/tools/cpp/include, @XMS_HOME@/tools/c/include</tt></dd>
 </dlentry>
 <dlentry>
  <dt><tt>WebSphere MQ Client libraries</tt>  </dt>
<dd/>  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__command">Command</xref>: 
  </dd>
  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__libpath">Library Path</xref>: <tt>@MQ_HOME@/lib64</tt></dd>
  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__includepath">Include Path</xref>: <tt>@MQ_HOME@/lib64</tt></dd>
 </dlentry>
 <dlentry>
  <dt><tt>Code that is common to both XMSSource and XMSSink is located in a directory ../Common relative to both of these operators.</tt>  </dt>
<dd/>  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__command">Command</xref>: 
  </dd>
  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__libpath">Library Path</xref>: <tt>../Common</tt></dd>
  <dd><xref href="../references/OperatorModel.xml#spldoc_reference_operator_model/context__dependencies__managedlibrary__includepath">Include Path</xref>: <tt>../Common</tt></dd>
 </dlentry>
</dl>
</section>
</refbody>
</reference>

